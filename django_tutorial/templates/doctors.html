{% extends 'base.html' %}

{% block title %}Our Doctors{% endblock %}

{% block content %}
<section class="section-padding bg-light">
    <div class="container">
        <div class="text-center mb-4">
            <h1 class="display-5 fw-bold mb-3">
                {% if selected_department %}
                {{selected_department.dep_name}} Specialists
                {% else %}
                Meet Our Medical Specialists
                {% endif %}
            </h1>
            <p class="text-muted mx-auto" style="max-width: 600px;">
                {% if selected_department %}
                Our team of highly qualified {{selected_department.dep_name}} specialists is here to provide you with
                the best medical care.
                {% else %}
                Our team of highly qualified and experienced doctors is here to provide you with the best medical care
                possible.
                {% endif %}
            </p>
        </div>

        <!-- Department Filter Buttons -->
        <div class="mb-4">
            <div class="d-flex justify-content-center flex-wrap gap-2">
                <a href="{% url 'doctors' %}"
                    class="btn btn-sm {% if not selected_department %}btn-primary{% else %}btn-outline-primary{% endif %}">
                    <i class="fas fa-th-large me-1"></i> All Departments
                </a>
                {% for dept in all_departments %}
                <a href="{% url 'doctors' %}?department={{dept.id}}"
                    class="btn btn-sm {% if selected_department.id == dept.id %}btn-primary{% else %}btn-outline-primary{% endif %}">
                    {{dept.dep_name}}
                </a>
                {% endfor %}
            </div>
        </div>

        <!-- Doctors Count -->
        <div class="text-center mb-4">
            <p class="text-muted">
                <i class="fas fa-user-md me-2"></i>
                <strong>{{ doctors|length }}</strong> doctor{{ doctors|length|pluralize }} found
                {% if selected_department %} in <strong>{{selected_department.dep_name}}</strong>{% endif %}
            </p>
        </div>

        <div class="row g-4">
            {% for d in doctors %}
            <div class="col-lg-3 col-md-6 animate-fade-in">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="position-relative overflow-hidden">
                        <img src="{{d.doc_image.url}}" class="card-img-top" alt="Dr. {{d.doc_name}}"
                            style="height: 300px; object-fit: cover; transition: transform 0.5s ease;">
                        <div class="position-absolute bottom-0 start-0 w-100 p-3 bg-gradient-dark text-white"
                            style="background: linear-gradient(transparent, rgba(0,0,0,0.8));">
                            <span class="badge bg-primary mb-2">{{d.dep_name}}</span>
                        </div>
                    </div>
                    <div class="card-body text-center p-4">
                        <h5 class="card-title mb-1">Dr. {{d.doc_name}}</h5>
                        <p class="text-primary fw-600 mb-2">{{d.doc_spec}}</p>

                        <div class="mb-3">
                            <h6 class="small fw-bold text-muted text-uppercase mb-2">Status & Availability</h6>

                            <!-- Display Present/Absent -->
                            <div class="mb-2">
                                {% if d.current_status == "Present" %}
                                <span class="badge bg-success py-2 px-3">Present Today</span>
                                {% elif d.current_status == "Absent" %}
                                <span class="badge bg-danger py-2 px-3">Absent Today</span>
                                {% else %}
                                <span class="badge bg-secondary py-2 px-3">Off Duty Today</span>
                                {% endif %}
                            </div>

                            <!-- Display Weekly Schedule with Time -->
                            <div class="small text-muted">
                                {% for avail in d.availabilities.all %}
                                <div class="mb-1">
                                    <span class="fw-bold">{{ avail.get_day_display }}:</span>
                                    <span>{{ avail.start_time|time:"H:i" }} - {{ avail.end_time|time:"H:i" }}</span>
                                </div>
                                {% empty %}
                                <div class="italic">No schedule set</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="d-flex justify-content-center mt-3">
                            <a href="{% url 'booking' %}" class="btn btn-primary btn-sm px-4 rounded-pill">Book
                                Appointment</a>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center">
                <p class="lead text-muted">No doctors found at the moment.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Call to Action -->
<section class="py-5 bg-white">
    <div class="container text-center">
        <h3 class="mb-4">Need a specific specialist?</h3>
        <p class="text-muted mb-4">You can browse by department or book an appointment directly.</p>
        <div class="d-flex justify-content-center gap-3">
            <a href="{% url 'department' %}" class="btn btn-outline-primary">View Departments</a>
            <a href="{% url 'booking' %}" class="btn btn-primary">Book Now</a>
        </div>
    </div>
</section>
{% endblock %}